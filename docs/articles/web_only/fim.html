<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estimation of the Fisher Information Matrix • varTestnlme</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Estimation of the Fisher Information Matrix">
<meta property="og:description" content="varTestnlme">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">varTestnlme</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/varTestnlme.html">
    <span class="fa fa-play-circle"></span>
     
    Get started
  </a>
</li>
<li>
  <a href="../../articles/index.html">Articles</a>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
<li>
  <a href="https://github.com/baeyc/varTestnlme">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="fim_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="fim_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Estimation of the Fisher Information Matrix</h1>
            
      
      <small class="dont-index">Source: <a href="http://github.com/baeyc/varTestnlme/blob/master/vignettes/web_only/fim.Rmd"><code>vignettes/web_only/fim.Rmd</code></a></small>
      <div class="hidden name"><code>fim.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://github.com/baeyc/varTestnlme/">varTestnlme</a></span><span class="op">)</span></pre></div>
<p>When testing that the variance of at least one random effect is equal to 0, the limiting distribution of the test statistic is a chi-bar-square distribution whose weights depend on the Fisher Information Matrix (FIM) of the model.</p>
<p><code>varCompTestnlme</code> provides different ways to handle the FIM. Depending on the package used to fit the model and on your preferences, it is possible to specify different options with the argument <code>fim</code>:</p>
<ul>
<li><p><code>fim="extract"</code>: (the default option) extract the FIM computed by the package used to fit the models. Please note that it might not be available in some cases. For example, for nonlinear models fitted with <code>lme4</code>. It might also rely on some linearization of the model.</p></li>
<li><p><code>fim="compute"</code>: to estimate the FIM using parametric bootstrap. Note that it can take some time to run. In this case, one must provide the bootstrap sample size with the <code>control</code> argument</p></li>
<li><p><code>fim=I</code>: with <code>I</code> a symmetric positive definite matrix, to provide your own FIM</p></li>
</ul>
<p>We provide some examples below.</p>
<div id="fitting-the-models" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting-the-models" class="anchor"></a>Fitting the models</h1>
<p>We use a dataset on high-flux hemodialyzers, available in the <code>nlme</code> package, in which ultrafiltration rates of 20 dialyzers were measured at 7 different dates. A nonlinear model is considered, with two random effects on the asymptote and on the rate.</p>
<p><span class="math display">\[y_{ij} = A_i*(1 - \exp(-e^{l_i}*(t_{ij} - c_i))) + \varepsilon_{ij}, \quad \varepsilon_{ij} \sim \mathcal{N}(0,\sigma^2)\]</span> <span class="math display">\[(A_i,l_i,c_i)^t \sim \mathcal{N}(\beta,\Gamma) \]</span></p>
<p>Suppose we wish to test if the asymptote is indeed random, i.e.: <span class="math display">\[H_0: \Gamma = \begin{pmatrix}
\gamma_1^2 &amp; 0 &amp; 0\\
0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0
\end{pmatrix} \quad \text{versus} \quad H_1 : \Gamma = \begin{pmatrix}
\gamma_1^2 &amp; 0 &amp; 0 \\
0 &amp; \gamma_2^2 &amp; 0 \\
0 &amp; 0 &amp; \gamma_3^2 
\end{pmatrix}\]</span></p>
<p>Using <code>nlme</code>, the two models under <span class="math inline">\(H_0\)</span> and <span class="math inline">\(H_1\)</span> can be specified in the following way:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span>
<span class="va">fm1.lis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlsList.html">nlsList</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/SSasympOff.html">SSasympOff</a></span><span class="op">(</span><span class="va">pressure</span>, <span class="va">Asym</span>, <span class="va">lrc</span>, <span class="va">c0</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Dialyzer</span><span class="op">)</span>
<span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html">nlme</a></span><span class="op">(</span><span class="va">fm1.lis</span>, random <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/pdDiag.html">pdDiag</a></span><span class="op">(</span><span class="va">Asym</span> <span class="op">+</span> <span class="va">lrc</span> <span class="op">+</span> <span class="va">c0</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">m0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/nlme.html">nlme</a></span><span class="op">(</span><span class="va">fm1.lis</span>, random <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/pdDiag.html">pdDiag</a></span><span class="op">(</span><span class="va">Asym</span> <span class="op">~</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></pre></div>
</div>
<div id="run-the-test" class="section level1">
<h1 class="hasAnchor">
<a href="#run-the-test" class="anchor"></a>Run the test</h1>
<p>To run the test with the default settings, simply use:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="../../reference/varCompTest.html">varCompTest</a></span><span class="op">(</span><span class="va">m1</span>,<span class="va">m0</span><span class="op">)</span>
<span class="co">#&gt; Variance components testing in mixed effects models</span>
<span class="co">#&gt; Testing that the variances of lrc and c0 are null</span>
<span class="co">#&gt; Likelihood ratio test statistic: </span>
<span class="co">#&gt;  LRT =  28.982 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Limiting distribution:</span>
<span class="co">#&gt; mixture of 3 chi-bar-square distributions with degrees of freedom 0, 1, 2</span>
<span class="co">#&gt; lower-bound for p-value: 3.6522e-08  upper bound for p-value: 2.9094e-07</span></pre></div>
<p>With the default settings, only bounds on the p-value are computed. In this case it is largely enough to reject the null hypothesis that the asymptote is the only random effect. However, if more precision is needed, one should specify it using <code>pval.comp = "both"</code> or <code>pval.comp="approx"</code>. By default, the <code>fim</code> option is set to <code>"extract"</code>, which means that <code>varCompTestnlme</code> will extract the FIM computed by the package used to fit the model (i.e. <code>nlme</code>, <code>lme4</code> or <code>saemix</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu"><a href="../../reference/varCompTest.html">varCompTest</a></span><span class="op">(</span><span class="va">m1</span>,<span class="va">m0</span>,pval.comp <span class="op">=</span> <span class="st">"both"</span>,fim<span class="op">=</span><span class="st">"extract"</span><span class="op">)</span>
<span class="co">#&gt; Variance components testing in mixed effects models</span>
<span class="co">#&gt; Testing that the variances of lrc and c0 are null</span>
<span class="co">#&gt; Error in extractFIM.lme(m1, msdata$structGamma): Error in nlme package for apVar in m1: Non-positive definite approximate variance-covariance</span>
<span class="co">#&gt;  Try to re-run with fim='compute'</span></pre></div>
<p>In this case we get an error message from <code>nlme</code> package stating that the FIM is non-positive definite. We will then use the <code>fim="compute"</code> option to approximate the FIM using parametric bootstrap, and we set the bootstrap sample size to 100 with the <code>control</code> argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="va">vt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/varCompTest.html">varCompTest</a></span><span class="op">(</span><span class="va">m1</span>,<span class="va">m0</span>,pval.comp<span class="op">=</span><span class="st">"both"</span>,fim<span class="op">=</span><span class="st">"compute"</span>,control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>B<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Variance components testing in mixed effects models</span>
<span class="co">#&gt; Testing that the variances of lrc and c0 are null</span>
<span class="co">#&gt; Computing Fisher Information Matrix by bootstrap...</span>
<span class="co">#&gt;   ...generating the B=100 bootstrap samples ...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Likelihood ratio test statistic: </span>
<span class="co">#&gt;  LRT =  28.982 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Limiting distribution:</span>
<span class="co">#&gt; mixture of 3 chi-bar-square distributions with degrees of freedom 0, 1, 2</span>
<span class="co">#&gt;  associated weights and sd:  0.253 (0), 0.5 (0), 0.247 (0) </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; p-value (from estimated weights): 1.6199e-07</span>
<span class="co">#&gt; lower-bound for p-value: 3.6522e-08  upper bound for p-value: 2.9094e-07</span></pre></div>
<p>The weights of the chi-bar-square distribution are provided, along with their standard deviations associated to the Monte Carlo approximation of the weights. Note that exact formulas exist for the weights when the number of chi-bar-square components is less than or equal to 3, in which cases no Monte Carlo approximation is needed and standard deviations are thus null.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://baeyc.github.io/">Charlotte Baey</a>, Estelle Kuhn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
